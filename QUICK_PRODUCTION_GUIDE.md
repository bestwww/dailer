# ‚ö° –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –†–µ—à–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

## üö® –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–ø–∞–ª–æ - –¥–µ–π—Å—Ç–≤—É–π—Ç–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ!

### üìû –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (3 –º–∏–Ω—É—Ç—ã)

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/dailer

# 2. –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
./emergency-recovery.sh quick

# –ò–õ–ò –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ quick –Ω–µ –ø–æ–º–æ–≥–ª–æ)
./emergency-recovery.sh full
```

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã (2 –º–∏–Ω—É—Ç—ã)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
./production-monitoring.sh check

# –°–æ–±—Ä–∞—Ç—å –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
./production-monitoring.sh logs
```

### üîÑ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ screen/tmux)
./production-monitoring.sh monitor

# –ò–õ–ò —á–µ—Ä–µ–∑ screen
screen -S monitoring
./production-monitoring.sh monitor
# Ctrl+A, D –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ screen
```

## üéØ –ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø–∞–¥–µ–Ω–∏–π

### 1. üíæ –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ (OOM Killer)
**–°–∏–º–ø—Ç–æ–º—ã**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–Ω–µ–∑–∞–ø–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å
free -h
docker stats --no-stream

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –ª–∏–º–∏—Ç–∞–º–∏
docker-compose -f docker-compose.production.yml up -d
```

### 2. üìù –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤
**–°–∏–º–ø—Ç–æ–º—ã**: –ó–∞–ø–æ–ª–Ω–µ–Ω –¥–∏—Å–∫, –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤
du -sh /var/lib/docker/containers/*/

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
docker system prune -f
./emergency-recovery.sh cleanup
```

### 3. üîå –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
**–°–∏–º–ø—Ç–æ–º—ã**: Backend –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
docker exec dialer_postgres pg_isready -U dialer_user -d dialer_db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ë–î
docker-compose restart postgres
```

### 4. üìû –ü—Ä–æ–±–ª–µ–º—ã —Å FreeSWITCH
**–°–∏–º–ø—Ç–æ–º—ã**: –ó–≤–æ–Ω–∫–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç, –≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FreeSWITCH
docker exec dialer_freeswitch fs_cli -x "status"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ FreeSWITCH
docker-compose restart freeswitch
```

### 5. üåê –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
**–°–∏–º–ø—Ç–æ–º—ã**: Timeout –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
docker network inspect dialer_dialer_network
docker exec dialer_backend ping -c 3 dialer_postgres
```

## üìä –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
./emergency-recovery.sh backup

# 2. –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
docker system prune -f

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
./production-monitoring.sh logs | grep -i error
```

### –ï–∂–µ–º–µ—Å—è—á–Ω–æ
```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
git pull origin main
docker-compose down
docker-compose build --no-cache
docker-compose -f docker-compose.production.yml up -d

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤
docker-compose pull
```

## üöÄ –£–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### 1. –ó–∞–º–µ–Ω–∏—Ç–µ docker-compose.yml –Ω–∞ production –≤–µ—Ä—Å–∏—é
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª
cp docker-compose.yml docker-compose.yml.backup

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp docker-compose.production.yml docker-compose.yml

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
docker-compose down
docker-compose up -d
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫–∏:
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
*/5 * * * * /path/to/dailer/production-monitoring.sh alert

# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
0 2 * * 1 /path/to/dailer/emergency-recovery.sh cleanup
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤ Docker
```bash
# –°–æ–∑–¥–∞–π—Ç–µ /etc/docker/daemon.json
sudo tee /etc/docker/daemon.json << EOF
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  }
}
EOF

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker
sudo systemctl restart docker
```

## üì± –ê–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ mail utils
sudo apt-get install mailutils

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ email –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
sed -i 's/admin@company.com/–≤–∞—à-email@domain.com/g' production-monitoring.sh
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —É @BotFather
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ –≤ production-monitoring.sh:
# curl -X POST "https://api.telegram.org/bot<TOKEN>/sendMessage" \
#   -d "chat_id=<CHAT_ID>&text=$subject: $message"
```

## üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **CPU > 80%** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- **Memory > 85%** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ  
- **Disk > 90%** - –∫—Ä–∏—Ç–∏—á–Ω–æ
- **DB connections > 80** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- **Container restart** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –ó–¥–æ—Ä–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "healthy"
- Backend –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`
- Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5173
- PostgreSQL –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Redis –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ ping

## üìã –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏

- [ ] –ó–∞–ø—É—Å—Ç–∏–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./production-monitoring.sh check`
- [ ] –°–æ–±—Ä–∞–ª –ª–æ–≥–∏: `./production-monitoring.sh logs`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ: `df -h`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ø–∞–º—è—Ç—å: `free -h`
- [ ] –í—ã–ø–æ–ª–Ω–∏–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: `./emergency-recovery.sh`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: Backend + Frontend
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: `./production-monitoring.sh monitor`
- [ ] –°–æ—Ö—Ä–∞–Ω–∏–ª –ª–æ–≥–∏ –ø–∞–¥–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- [ ] –û–±–Ω–æ–≤–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Ö–æ–¥–∫–∞–º–∏

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫**: [–≤–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã]
- **DevOps**: [–∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–∞–Ω–¥—ã]
- **–ñ—É—Ä–Ω–∞–ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤**: `/logs/incidents/`

---

**üí° –°–æ–≤–µ—Ç**: –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –∑–∞–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –¥–µ—Ä–∂–∏—Ç–µ –ø–æ–¥ —Ä—É–∫–æ–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö! 