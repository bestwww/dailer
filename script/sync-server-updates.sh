#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–ô –°–ï–†–í–ï–†–ê"
echo "=================================="

# –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
log() {
    echo "[$(date '+%H:%M:%S')] $1: $2"
}

log "INFO" "üìã –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π..."

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
log "INFO" "üîç –¢–µ–∫—É—â–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
git status --porcelain

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ stash
log "INFO" "üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ stash..."
git stash push -m "–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ FreeSWITCH –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º $(date)"

# –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
log "INFO" "‚¨áÔ∏è –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
if git pull origin main; then
    log "SUCCESS" "‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    log "ERROR" "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –ø–æ—è–≤–∏–ª–æ—Å—å –Ω–æ–≤–æ–≥–æ
log "INFO" "üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:"
ls -la *.sh 2>/dev/null | grep -E "(check-server-ip|setup-caller-id)" || echo "–°–∫—Ä–∏–ø—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
if [ -f "check-server-ip.sh" ]; then
    log "SUCCESS" "‚úÖ –°–∫—Ä–∏–ø—Ç check-server-ip.sh –¥–æ–±–∞–≤–ª–µ–Ω"
    chmod +x check-server-ip.sh
    log "INFO" "üîß –ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    log "ERROR" "‚ùå check-server-ip.sh –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ stash
log "INFO" "üì¶ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
git stash list

echo ""
echo "üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "================="
echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: ./check-server-ip.sh"
echo "2. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: git stash pop"
echo "3. –°–æ–æ–±—â–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É IP –∞–¥—Ä–µ—Å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ whitelist"
echo ""
echo "‚ÑπÔ∏è  –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ FreeSWITCH —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ stash"
echo "   –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: git stash pop" 