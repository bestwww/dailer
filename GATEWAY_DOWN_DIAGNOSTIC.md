# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã Gateway DOWN

## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è host networking –¥–ª—è FreeSWITCH:
- ‚úÖ **FreeSWITCH –∑–∞–ø—É—â–µ–Ω** —Å host networking
- ‚úÖ **–ü—Ä–æ—Ñ–∏–ª—å external —Ä–∞–±–æ—Ç–∞–µ—Ç** (RUNNING)  
- ‚úÖ **Gateway sip_trunk –Ω–∞–π–¥–µ–Ω**
- ‚ùå **Gateway –≤ —Å—Ç–∞—Ç—É—Å–µ DOWN** (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å UP)

## üî¨ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
cd ~/dailer
git pull origin main

# –ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê host networking
./diagnose-host-networking.sh
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ network mode** - –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ host networking
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤** —Ö–æ—Å—Ç vs –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** ping –∏ TCP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
4. **–ê–Ω–∞–ª–∏–∑ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏** –∏ DNS
5. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π ping gateway** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ UP/DOWN —Å—Ç–∞—Ç—É—Å–∞

## üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã Gateway DOWN

### 1. **SIP —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5070**
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø
- –ò–∑–º–µ–Ω–∏–ª–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

### 2. **Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**
- –•–æ—Å—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 5070
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –≤–∞—à–µ–≥–æ IP

### 3. **SIP —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ SIP –ø–∞–∫–µ—Ç—ã**
- –ü–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –æ–±—ã—á–Ω—ã—Ö TCP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –¢—Ä–µ–±—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ SIP OPTIONS –∑–∞–ø—Ä–æ—Å—ã

### 4. **Host networking —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–æ–ª—É—á–∏–ª –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏ —Ö–æ—Å—Ç–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π –≤ Docker

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–î–∞–∂–µ –µ—Å–ª–∏ Gateway –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç DOWN, SIP –∑–≤–æ–Ω–∫–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:

```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫
./test-sip-trunk.sh call 79206054020

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
./manage-freeswitch-host.sh logs
```

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ gateway:**
```bash
docker exec dialer_freeswitch_host fs_cli -x "sofia profile external killgw sip_trunk"
sleep 2
docker exec dialer_freeswitch_host fs_cli -x "sofia profile external rescan"
```

### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ FreeSWITCH host networking:**
```bash
./manage-freeswitch-host.sh restart
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ SIP:**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä 62.141.121.197:5070 –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£—Ç–æ—á–Ω–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 4. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ gateway:**
–ï—Å–ª–∏ peer-to-peer –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π:
```xml
<param name="register" value="true"/>
<param name="username" value="–≤–∞—à_–ª–æ–≥–∏–Ω"/>
<param name="password" value="–≤–∞—à_–ø–∞—Ä–æ–ª—å"/>
```

## üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ **Gateway –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ UP:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è peer-to-peer —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- SIP –∑–≤–æ–Ω–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å

### ‚ùå **Gateway –ø–æ—Å—Ç–æ—è–Ω–Ω–æ DOWN:**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–≤—è–∑—å —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º SIP

### ‚ö†Ô∏è **Ping —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ Gateway DOWN:**
- SIP —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω—ã credentials –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤

–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Ç–µ—Å—Ç - —Ä–µ–∞–ª—å–Ω—ã–µ –∑–≤–æ–Ω–∫–∏:
```bash
# –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
./test-sip-trunk.sh call 79206054020

# –¢–µ—Å—Ç —Å –æ—Ç–ª–∞–¥–∫–æ–π
./test-sip-trunk.sh debug call 79206054020
```

**–ï—Å–ª–∏ –∑–≤–æ–Ω–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å—Ç–∞—Ç—É—Å DOWN!

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –≤—ã–≤–æ–¥:
1. `./diagnose-host-networking.sh`
2. `./test-sip-trunk.sh call 79206054020`
3. `./manage-freeswitch-host.sh logs` 