# üìû –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ SIP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ–ª—É—á–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç SIP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
- **IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞**: `46.173.16.147` ‚úÖ **–î–û–ë–ê–í–õ–ï–ù –í WHITELIST**
- **SIP –ø—Ä–æ–≤–∞–π–¥–µ—Ä**: `62.141.121.197:5070`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: **–ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø** (—Ä–∞–±–æ—Ç–∞ –ø–æ IP whitelist)
- **Caller ID**: **–õ–Æ–ë–û–ô –ù–û–ú–ï–†** —Ä–∞–∑—Ä–µ—à–µ–Ω

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SIP

### ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
–ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç IP-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –ø–æ—ç—Ç–æ–º—É:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ (`register="false"`)
- Username/password –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ IP whitelist

### ‚úÖ Caller ID –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
–¢–µ–∫—É—â–∏–π Caller ID: `79058615815` (—Ñ–æ—Ä–º–∞—Ç: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7, –±–µ–∑ +)

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
```bash
./apply-sip-fix.sh
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
```bash
git add .
git commit -m "fix: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SIP –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
git push origin main
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

**–ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**
```bash
git pull origin main
docker-compose restart freeswitch_host
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:**
```bash
./diagnose-sip-detailed.sh
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Gateway —Å—Ç–∞—Ç—É—Å: `UP` (–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ)
- –¢–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫: —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–æ–∫
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ `NORMAL_TEMPORARY_FAILURE`

## üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)

–ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–≤–æ–Ω–∫–∏ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```xml
<param name="register" value="false"/>
<param name="username" value=""/>
<param name="password" value=""/>
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

–î–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```xml
<param name="register" value="true"/>
<param name="auth-username" value="USERNAME"/>
<param name="auth-password" value="PASSWORD"/>
<param name="challenge-realm" value="62.141.121.197"/>
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [x] IP `46.173.16.147` –¥–æ–±–∞–≤–ª–µ–Ω –≤ whitelist –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- [x] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Ä–∞–±–æ—Ç–∞ –ø–æ IP)
- [x] –õ—é–±–æ–π Caller ID —Ä–∞–∑—Ä–µ—à–µ–Ω
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ git
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] FreeSWITCH –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] Gateway –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `UP`
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ï—Å–ª–∏ gateway –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç UNKNOWN —Å—Ç–∞—Ç—É—Å:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `register="false"` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ IP –¥–æ–±–∞–≤–ª–µ–Ω –≤ whitelist –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: `62.141.121.197:5070`

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ 403 Forbidden:
1. IP –Ω–µ –≤ whitelist –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ 408 Request Timeout:
1. –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
2. –ü—Ä–æ–≤–∞–π–¥–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
3. –ù–µ–≤–µ—Ä–Ω—ã–π –ø–æ—Ä—Ç –∏–ª–∏ –∞–¥—Ä–µ—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –ï—Å–ª–∏ –∑–≤–æ–Ω–∫–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç (NORMAL_TEMPORARY_FAILURE):
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ IP –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ whitelist
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ FreeSWITCH –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs dialer_freeswitch_host`

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./diagnose-sip-detailed.sh`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs dialer_freeswitch_host`
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É SIP —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏

## üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ SIP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–æ–∑–¥–∞–π—Ç–µ cron –∑–∞–¥–∞—á—É:

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
*/5 * * * * /path/to/diagnose-sip-detailed.sh >> /var/log/sip-monitor.log 2>&1
```

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ SIP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã. 