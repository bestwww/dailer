# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï FreeSWITCH

## ‚ö° –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:
- ‚ùå –ü—Ä–æ—Ñ–∏–ª—å 'external' –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (0 profiles)
- ‚ùå Gateway 'sip_trunk' –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω  
- ‚ùå –û—à–∏–±–∫–∞ "INVALID_GATEWAY" –ø—Ä–∏ –∑–≤–æ–Ω–∫–∞—Ö
- ‚ö†Ô∏è Docker Compose v2 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º

## üöÄ –°–†–û–ß–ù–û–ï –†–ï–®–ï–ù–ò–ï (3 –º–∏–Ω—É—Ç—ã):

### –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd ~/dailer
git pull origin main

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
./fix-freeswitch-issues-v2.sh
```

## üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç v2.0:

1. **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Docker Compose** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å v1 –∏ v2
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ XML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞** - –Ω–∞—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **–ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –º–æ–¥—É–ª–∏ FreeSWITCH
4. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ Sofia** - –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å external
5. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–µ—Ç —Ä–∞–±–æ—á—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ fallback
6. **–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞** - –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

## üìã –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

### –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# 1. –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
cd ~/dailer
docker compose down
docker rm -f dialer_freeswitch
docker volume prune -f

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose up -d freeswitch

# 3. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
sleep 30

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
docker exec dialer_freeswitch fs_cli -x "sofia status"
```

### –ï—Å–ª–∏ –º–æ–¥—É–ª—å mod_sofia –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ FreeSWITCH CLI
docker exec -it dialer_freeswitch fs_cli

# –í CLI –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
load mod_sofia
sofia profile external start
quit
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å external –∑–∞–≥—Ä—É–∂–µ–Ω
docker exec dialer_freeswitch fs_cli -x "sofia status"

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å external –ø—Ä–æ—Ñ–∏–ª—å –∏ gateway sip_trunk

# –¢–µ—Å—Ç SIP —Ç—Ä–∞–Ω–∫–∞
./test-sip-trunk.sh test
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
Name        Type                                       Data      State
=================================================================================================
external    profile   sip:mod_sofia@192.168.1.100:5060      RUNNING (0)
=================================================================================================
1 profiles 1 aliases
```

## üìû –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```bash
   ./fix-freeswitch-issues-v2.sh > fix_result.log 2>&1
   cat fix_result.log
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ FreeSWITCH:**
   ```bash
   docker logs dialer_freeswitch --tail=50
   ```

3. **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π** —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤

---

**üí° –í–∞–∂–Ω–æ**: –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏! 