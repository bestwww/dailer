# üê≥ FreeSWITCH Docker - –ì–û–¢–û–í–´–ô –û–ë–†–ê–ó (FINAL SOLUTION)
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ FreeSWITCH v1.10.11 –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ SignalWire
FROM ghcr.io/ittoyxk/freeswitch:v1.10.11

# üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
LABEL maintainer="Dailer Team"
LABEL description="FreeSWITCH for Dailer - –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑"
LABEL version="1.10.11-ready"

# üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=UTC

# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
RUN apt-get update && \
    apt-get install -y \
        # –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        netcat-openbsd \
        telnet \
        net-tools \
        iputils-ping \
        # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
        curl \
        vim \
        htop && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    echo "‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# üóÇÔ∏è –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
RUN mkdir -p \
        /var/lib/freeswitch/storage \
        /var/lib/freeswitch/recordings \
        /var/log/freeswitch \
        /etc/freeswitch && \
    echo "‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã"

# üîß –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é FreeSWITCH –µ—Å–ª–∏ –µ—Å—Ç—å
# COPY ../../freeswitch/conf /usr/local/freeswitch/conf/

# üìÇ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
WORKDIR /usr/local/freeswitch

# üîå –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
EXPOSE 5060/udp 5060/tcp 5080/udp 5080/tcp
EXPOSE 16384-32768/udp
EXPOSE 8021/tcp

# üè• –î–æ–±–∞–≤–ª—è–µ–º healthcheck
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD fs_cli -x "status" | grep -q "UP" || exit 1

# üìù –ö–æ–ø–∏—Ä—É–µ–º entrypoint —Å–∫—Ä–∏–ø—Ç
COPY docker-entrypoint-ready.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# üöÄ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["freeswitch", "-nonat", "-c"] 