# üê≥ FreeSWITCH Docker - –ë–ê–ó–û–í–´–ô –û–ë–†–ê–ó  
# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –±–µ–∑ FreeSWITCH –¥–ª—è —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
FROM ubuntu:22.04

# üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
LABEL maintainer="Dailer Team"
LABEL description="Base image for FreeSWITCH - manual installation required"
LABEL version="base"

# üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=UTC

# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && \
    apt-get install -y \
        # –ë–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
        wget \
        curl \
        gnupg2 \
        ca-certificates \
        software-properties-common \
        lsb-release \
        # –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        netcat-openbsd \
        telnet \
        net-tools \
        iputils-ping \
        dnsutils \
        # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
        vim \
        nano \
        htop \
        tree \
        # –ê—É–¥–∏–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        libasound2-dev \
        libsndfile1-dev \
        # –û—Å–Ω–æ–≤–Ω—ã–µ dev –ø–∞–∫–µ—Ç—ã (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è)
        build-essential \
        cmake \
        autoconf \
        automake \
        libtool \
        pkg-config \
        git && \
    echo "‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# üóÇÔ∏è –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π FreeSWITCH
RUN mkdir -p \
        /var/lib/freeswitch/storage \
        /var/lib/freeswitch/recordings \
        /var/lib/freeswitch/sounds \
        /var/log/freeswitch \
        /etc/freeswitch \
        /usr/local/freeswitch/bin \
        /usr/local/freeswitch/lib \
        /usr/local/freeswitch/mod && \
    echo "‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∞"

# üë§ –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è freeswitch
RUN useradd --system --home-dir /var/lib/freeswitch --shell /bin/false freeswitch && \
    chown -R freeswitch:freeswitch \
        /var/lib/freeswitch \
        /var/log/freeswitch \
        /etc/freeswitch \
        /usr/local/freeswitch && \
    echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å freeswitch —Å–æ–∑–¥–∞–Ω"

# üßπ –û—á–∏—Å—Ç–∫–∞
RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    rm -rf /tmp/* && \
    echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# üìÇ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
WORKDIR /etc/freeswitch

# üîå –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
EXPOSE 5060/udp 5060/tcp 5080/udp 5080/tcp
EXPOSE 16384-32768/udp
EXPOSE 8021/tcp

# üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π entrypoint
COPY docker-entrypoint-base.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# üöÄ –ó–∞–ø—É—Å–∫
ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["bash"] 