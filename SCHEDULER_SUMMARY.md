# üïê –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–∞–º–ø–∞–Ω–∏–π - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–°–µ—Ä–≤–∏—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞** (`backend/src/services/scheduler.ts`)
- ‚úÖ –ö–ª–∞—Å—Å `SchedulerService` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π cron jobs
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞/–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è
- ‚úÖ –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏ —Å cron –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è cron –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ (–∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ Graceful shutdown –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã

### 2. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `Campaign`:
  - `isScheduled: boolean` - –≤–∫–ª—é—á–µ–Ω –ª–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
  - `scheduledStart?: Date` - –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞
  - `scheduledStop?: Date` - –≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
  - `isRecurring: boolean` - –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
  - `cronExpression?: string` - cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `CreateCampaignRequest` –∏ `UpdateCampaignRequest`

### 3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è `004_add_scheduler_fields.sql`:
  - –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `campaigns`
  - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (constraints)
  - –¢–∞–±–ª–∏—Ü–∞ –ª–æ–≥–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ `scheduler_logs`
  - –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `CampaignModel` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏

### 4. **API endpoints**
- ‚úÖ `POST /api/campaigns/:id/schedule` - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
- ‚úÖ `DELETE /api/campaigns/:id/schedule` - –æ—Ç–º–µ–Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ `GET /api/campaigns/scheduler/status` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- ‚úÖ `GET /api/campaigns/scheduler/campaigns` - –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
- ‚úÖ `POST /api/campaigns/scheduler/validate-cron` - –≤–∞–ª–∏–¥–∞—Ü–∏—è cron –≤—ã—Ä–∞–∂–µ–Ω–∏–π

### 5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ Graceful shutdown –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∏–∞–ª–µ—Ä-—Å–µ—Ä–≤–∏—Å–æ–º
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

### –¢–∏–ø—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
1. **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** - –∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è
2. **–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏** - –ø–æ cron –≤—ã—Ä–∞–∂–µ–Ω–∏—é
3. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** - –∏ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ, –∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```typescript
// –ó–∞–ø—É—Å–∫ –∫–∞–º–ø–∞–Ω–∏–∏ –∑–∞–≤—Ç—Ä–∞ –≤ 9:00
scheduledStart: new Date('2024-01-15T09:00:00.000Z')

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ –≤ 18:00
scheduledStop: new Date('2024-01-15T18:00:00.000Z')

// –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –≤ 9:00
isRecurring: true
cronExpression: '0 9 * * 1-5'
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ cron –≤—ã—Ä–∞–∂–µ–Ω–∏—è:
- `0 9 * * 1-5` - –∫–∞–∂–¥—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –≤ 9:00
- `30 14 * * *` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 14:30
- `0 */2 * * *` - –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- `0 0 1 * *` - 1 —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ 00:00

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **node-cron** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cron jobs
- **TypeScript** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **PostgreSQL** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **Express.js** - API endpoints

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
- **Singleton pattern** –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- **Event-driven architecture** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥–∏–∞–ª–µ—Ä–æ–º
- **Graceful shutdown** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- **Extensive logging** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –í–∞–ª–∏–¥–∞—Ü–∏—è cron –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–π
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ API
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è cron –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ (start/stop)

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
üïê –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–∞–º–ø–∞–Ω–∏–π...
‚úÖ "0 9 * * 1-5" - –≤–∞–ª–∏–¥–Ω–æ
‚úÖ "30 14 * * *" - –≤–∞–ª–∏–¥–Ω–æ
‚úÖ "0 */2 * * *" - –≤–∞–ª–∏–¥–Ω–æ
‚ùå "invalid-cron" - –Ω–µ–≤–∞–ª–∏–¥–Ω–æ
‚úÖ "0 0 1 1 *" - –≤–∞–ª–∏–¥–Ω–æ
üîÑ –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: 2025-07-13T10:31:30.020Z
```

## üéØ –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### ‚úÖ –≠—Ç–∞–ø 6.2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–∞–º–ø–∞–Ω–∏–π (cron jobs)** - –ó–ê–í–ï–†–®–ï–ù
- ‚è≥ –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä–æ–≤ - —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
- ‚è≥ Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
- ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–∑–≤–æ–Ω–∞ - —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
- ‚è≥ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤ - —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:
- ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ API endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (frontend)

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ UI** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –≤ frontend
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞** –Ω–æ–º–µ—Ä–æ–≤
3. **Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–∑–≤–æ–Ω–∞** —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

**–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–∞–º–ø–∞–Ω–∏–π —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ 